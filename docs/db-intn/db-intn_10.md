# 第二部分：分布系统

> 分布系统是指一个你甚至不知道其存在的计算机的故障可能会使你自己的计算机无法使用。
> 
> 莱斯利·兰波特

没有分布系统，我们将无法进行电话通话、转账或在长距离上交换信息。我们每天都在使用分布系统。有时，甚至没有意识到：任何客户端/服务器应用程序都是分布系统。

对于许多现代软件系统来说，*垂直*扩展（在更大、更快的机器上运行相同软件，具有更多的 CPU、RAM 或更快的磁盘）不可行。更大的机器更昂贵，更难替换，并可能需要特殊的维护。一个替代方案是*水平*扩展：在多台通过网络连接并作为单一逻辑实体运行的机器上运行软件。

分布系统在大小上可能会有所不同，从几台到数百台机器不等，并且在参与者的特性上也可能会有所不同，从小型手持设备或传感器到高性能计算机。

数据库系统主要在单节点上运行的时代早已一去不复返，大多数现代数据库系统将多个节点连接成集群，以增加存储容量、提升性能和提高可用性。

尽管分布式计算的一些理论突破并不新鲜，但它们的大多数实际应用是比较近期的。今天，我们看到对这一主题越来越多的兴趣，进行了更多的研究，并进行了新的开发。

## 第二部分。基本定义

在分布式系统中，我们有多个*参与者*（有时称为*进程*、*节点*或*副本*）。每个参与者都有自己的本地*状态*。参与者通过交换*消息*来通信，使用它们之间的通信*链接*。

进程可以使用*时钟*来访问时间，时钟可以是*逻辑*的或*物理*的。逻辑时钟使用一种单调增长的计数器来实现。物理时钟，也称为*挂钟*，与物理世界中的时间概念绑定，可以通过进程本地的方式访问；例如，通过操作系统。

谈论分布系统时不可能不提到由于其部件分散在彼此之间而导致的固有困难。远程进程通过可能缓慢且不可靠的链接进行通信，这使得了解远程进程的确切状态变得更加复杂。

分布系统领域的大部分研究与一个事实相关：没有什么是完全可靠的：通信通道可能会延迟、重新排序或无法传递消息；进程可能会暂停、放慢、崩溃、失控或突然停止响应。

并发和分布式编程领域有许多共同主题，因为 CPU 是微小的分布式系统，具有链接、处理器和通信协议。你会在“一致性模型”中看到与并发编程很多相似之处。然而，由于远程各方之间通信的成本和链接及进程的不可靠性，大多数原语不能直接重用。

要克服分布式环境的困难，我们需要使用一类特定的算法，*分布式算法*，它们具有本地和远程状态以及执行的概念，并能够在不可靠的网络和组件故障情况下工作。我们描述算法的时候使用*状态*和*步骤*（或*阶段*），它们之间有*转换*。每个进程在本地执行算法步骤，并且本地执行和进程交互的组合构成了分布式算法。

分布式算法描述了多个独立节点的本地行为和互动。节点通过向彼此发送消息来进行通信。算法定义了参与者角色、交换的消息、状态、转换、执行的步骤、传输媒介的特性、时间假设、故障模型以及描述进程及其互动的其他特性。

分布式算法用于多种不同目的：

协调

监督多个工作者的行动和行为的进程。

合作

多个参与者互相依赖以完成各自的任务。

传播

过程在快速且可靠地向所有感兴趣的方进行信息传播中合作。

共识

达成多个进程之间的协议。

在本书中，我们讨论算法在其使用环境中的情况，并更偏向于实用而非纯学术的材料。首先，我们涵盖所有必要的抽象、进程及其之间的连接，然后逐步构建更复杂的通信模式。我们从 UDP 开始，发送方无法保证其消息是否已达到目的地；最终，我们达成共识，多个进程就特定值达成一致。
